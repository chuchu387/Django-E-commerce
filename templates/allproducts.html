{% extends 'base.html' %}
{% block title %}Our Products{% endblock %}

{% block content %}
<div class="container">
  <div class="d-flex flex-wrap justify-content-between align-items-end gap-2 mb-4">
    <h1 class="page-title mb-0">Our Products</h1>
    <p class="text-muted mb-0">Freshly curated cuisines across all categories.</p>
  </div>

  <nav class="category_nav mb-4" aria-label="Product categories">
    {% for category in categories %}
      {% if category.prefetched_products %}
        <a class="category_chip" href="#category-{{ category.id }}">
          {{ category.title }} <span class="category_chip-count">{{ category.prefetched_products|length }}</span>
        </a>
      {% endif %}
    {% endfor %}
  </nav>

  {% for category in categories %}
    {% if category.prefetched_products %}
      <section class="mb-5" id="category-{{ category.id }}">
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
          <h2 class="h4 mb-0">{{ category.title }}</h2>
          <span class="category_count-badge">{{ category.prefetched_products|length }} items</span>
        </div>
        <div class="row g-4">
          {% for p in category.prefetched_products %}
            <div class="col-sm-6 col-lg-4">
              <article class="product_card h-100 p-3">
                <div class="product_image-wrapper rounded-4">
                  <a href="{% url 'ecomapp:productdetail' p.slug %}">
                    <img src="{{ p.image.url }}" alt="{{ p.title }}" class="img-fluid">
                  </a>
                </div>
                <div class="pt-3 d-flex flex-column h-100">
                  <h3 class="product_title h5 mb-2">
                    <a class="text-decoration-none" href="{% url 'ecomapp:productdetail' p.slug %}">{{ p.title }}</a>
                  </h3>
                  <p class="text-muted small mb-2">{{ p.category.title }}</p>
                  <p class="product_price mb-2">
                    <small class="text-muted text-decoration-line-through me-2">Rs. {{ p.marked_price }}</small>
                    <strong>Rs. {{ p.selling_price }}</strong>
                  </p>
                  <p class="text-muted flex-grow-1">{{ p.description|truncatechars:100 }}</p>
                  <a href="{% url 'ecomapp:addtocart' p.id %}" class="btn btn-primary product_cta mt-2">Add to Cart</a>
                </div>
              </article>
            </div>
          {% endfor %}
        </div>
      </section>
    {% endif %}
  {% empty %}
    <p class="text-center text-muted mt-4">No products available.</p>
  {% endfor %}
</div>
{% endblock %}
